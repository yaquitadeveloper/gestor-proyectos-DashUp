---
// import { Icon } from 'astro-icon/components'

---

<aside class="w-64 bg-gray-100 border-r border-gray-300 flex flex-col">
  <!-- BotÃ³n para crear nuevo workspace -->
  <div class="p-4 border-b">
    <button id="createWorkspaceBtn" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition-colors">
      + Crear Espacio de Trabajo
    </button>
  </div>

  <!-- Lista dinÃ¡mica de workspaces -->
  <div class="flex-1 overflow-y-auto">
    <div class="px-4 py-2">
      <h3 class="text-xs font-semibold text-gray-400 uppercase mb-2">
        Espacios de trabajo
      </h3>
      <div id="workspacesList" class="space-y-1">
        <!-- Se llenarÃ¡ dinÃ¡micamente -->
      </div>
    </div>
  </div>
</aside>

<script>
  import { initializeSidebar } from '../../scripts/sidebarManager';
  
  // FunciÃ³n para esperar a que el DOM estÃ© listo
  function waitForDOM(): Promise<void> {
    return new Promise((resolve) => {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => resolve());
      } else {
        resolve();
      }
    });
  }

  // Inicializar sidebar cuando estÃ© listo
  async function init() {
    await waitForDOM();
    
    // Obtener el usuario autenticado
    const { onAuthStateChanged } = await import("firebase/auth");
    const { auth } = await import("../../lib/firebase");
    
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log('ðŸ‘¤ Usuario autenticado:', user.email);
        initializeSidebar(user.uid);
      } else {
        console.log('ðŸ”“ Usuario no autenticado');
      }
    });
  }

  init();
</script>