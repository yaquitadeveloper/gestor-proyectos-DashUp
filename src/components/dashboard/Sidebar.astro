

<aside class="w-64 bg-gray-100 border-r border-gray-300 flex flex-col">
  <!-- Bot√≥n para crear nuevo workspace -->
  <div class="p-4 border-b">
    <button id="createWorkspaceBtn" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition-colors">
      + Crear Espacio de Trabajo
    </button>
  </div>

  <!-- Lista din√°mica de workspaces -->
  <div class="flex-1 overflow-y-auto">
    <div class="px-4 py-2">
      <h3 class="text-xs font-semibold text-gray-400 uppercase mb-2">
        Espacios de trabajo
      </h3>
      <div id="workspacesList" class="space-y-1">
        <!-- Se llenar√° din√°micamente -->
      </div>
    </div>
  </div>
</aside>

<script>
  import { initializeSidebar } from '../../scripts/sidebarManager';
  import { createWorkspace } from '../../scripts/workspaceManager';
  
  // Funci√≥n para esperar a que el DOM est√© listo
  function waitForDOM(): Promise<void> {
    return new Promise((resolve) => {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => resolve());
      } else {
        resolve();
      }
    });
  }

  // Inicializar sidebar cuando est√© listo
  async function init() {
    await waitForDOM();
    
    // Obtener el usuario autenticado
    const { onAuthStateChanged } = await import("firebase/auth");
    const { auth } = await import("../../lib/firebase");
    
    onAuthStateChanged(auth, (user) => {
      if (user) {
        initializeSidebar(user.uid);

        const createWorkspaceBtn = document.getElementById('createWorkspaceBtn');
        if (createWorkspaceBtn) {
          createWorkspaceBtn.addEventListener('click', async () => {
            const workspaceName = prompt("Ingresa el nombre del nuevo espacio de trabajo:");
            if (workspaceName) {
              try {
                // Aqu√≠, 'description' es un valor por defecto. Deber√≠as obtenerlo de un formulario real.
                const newWorkspaceId = await createWorkspace(workspaceName, 'Descripci√≥n por defecto', user.uid);
               
                
                // Actualizar la lista de workspaces para mostrar el nuevo
                initializeSidebar(user.uid);
              } catch (error) {
                console.error('‚ùå Error al crear workspace:', error);
                if (error instanceof Error) {
                  alert(error.message);
                } else {
                  alert(String(error));
                }
                
              }
            }
          });
        }
        
      } else {
        console.log('üîì Usuario no autenticado');
      }
    });
  }

  init();
</script>